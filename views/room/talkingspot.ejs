<h2>Talking Spot</h2>
<h3>Chatter ID:<%= id %></h3>
<div id='message_area'>
  <ul id='message_list'>
  </ul>
</div>
<div>
  <input type='text' id='message'></input>
  <input type='button' id='send' value='送信'></input>
</div>
<!--SCRIPTS-->

<!--SCRIPTS END-->
<script type="text/javascript">
$(function(){
  socket.get('/room/checkin',{'userID':<%= id %>},function(res){
  });
  socket.on('message',function(msg){
    var model = msg['model'];
    if(model=='user') {
      var checkinMessage = 'In!!:'+msg['id'];
      alert(checkinMessage);
    } else if(model=='chat'){ //chatメッセージ時の処理を追加
      var chatMessage = '<li>'+msg['data']['id']+':'+msg['data']['message']+'</li>';
      $('#message_list').append(chatMessage);
    }
  });
  $('#send').click(function(){//メッセージの送信
    console.log('sending:' + $('#message').val());
    socket.post('/chat/say', {'chatterId':<%= id %>, 'message':$('#message').val()},function(res){});
    $('#message').val('');
  });

  window.log = function(obj) {
    socket.post('/dump', obj, function(res){});
  };


  log({'msg':'debug'});
  log('string test');


});
</script>